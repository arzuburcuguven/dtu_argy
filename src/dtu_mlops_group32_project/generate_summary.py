import torch
from transformers import BartTokenizer
from model import BartSummarizer
from typing import Dict, Union

def generate_summary(text: str, model_path: str = "models/checkpoints/final_model.pt") -> Dict[str, str]:
    """
    Generate summary from input text using loaded BART model.
    
    Args:
        text: Input text to summarize
        model_path: Path to the saved model weights
        
    Returns:
        Dict containing original text and generated summary
    """
    model = BartSummarizer()
    model.load_state_dict(torch.load(model_path))
    model.eval()
    
    # Move to GPU if available
    device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    model = model.to(device)
    
    inputs = model.tokenizer(
        text,
        max_length=model.max_source_length,
        padding="max_length",
        truncation=True,
        return_tensors="pt"
    ).to(device)
    
    with torch.no_grad():
        summary_ids = model.model.generate(
            inputs.input_ids,
            attention_mask=inputs.attention_mask,
            max_length=model.max_target_length,
            num_beams=4,
            early_stopping=True
        )
    
    summary = model.tokenizer.decode(summary_ids[0], skip_special_tokens=True)
    
    return {
        "input_text": text,
        "summary": summary
    }

#result = generate_summary("{article: sexual development in males is a multistep process , implying a delicate network of molecular events that directs the bipotential gonad to differentiate into testis ( sex determination ) and consequent differentiation of internal and external genitalia in the presence of testicular hormones ( sex differentiation ) . \n alteration of any genetic or endocrine factors involved in testicular development may lead to 46 xy disorders of sexual development ( dsd ) . \n genital ambiguity in patients with 46 xy dsd may either occur due to the disorders in gonadal development or due to the disruption in androgen synthesis or action . \n patients with disorders of gonadal development may present with either complete or partial forms of gonadal dysgenesis . \n swyer 's syndrome or complete gonadal dysgenesis ( cgd ) is characterized by unambiguous female genitalia , bilateral streak gonads , and elevated gonadotropins . \n partial gonadal dysgenesis ( pgd ) may have a wide spectrum of phenotypes associated with ambiguous genitalia , varying degree of hypospadias and testis of variable size and echotexture present along the path of decent . \n ovotesticular dsd ( ot - dsd ) is a rare condition marked by the presence of both ovarian and testicular tissue in an individual while congenital bilateral anorchia ( cba ) is characterized by the complete absence of testicular tissue in genotypic males . \n disorders of androgen synthesis may occur due to deficiency of various enzymes involved in the steroidogenesis . \n congenital adrenal hyperplasia ( cah ) due to 17-hydroxysteroid dehydrogenase 3 ( 17-hsd3 ) is caused by the mutations in hsd17b3 gene which is required for the conversion of androstenedione to testosterone . \n deficiency of this enzyme results in feminized genitalia in newborns due to the low testosterone levels . \n mutations in srd5a2 gene impairs the activity of enzyme 5-reductase and hence the conversion of testosterone to its more potent form dihydrotestosterone ( dht ) . \n individuals with 5-reductase deficiency ( 5-rd ) are often raised as females due to undermasculinized genitalia but the gender role changes soon after attaining puberty . \n mutations in androgen receptor gene may lead to the androgen insensitivity syndrome ( ais ) which can be partial androgen insensitivity syndrome ( pais ) or complete androgen insensitivity syndrome ( cais ) and is the most common cause of 46xy dsd . \n the spectrum of phenotypes associated with ais may range from completely female through mixed male / female to completely male type . in 1995 , \n charmian quigley and frank french proposed new grading system for the phenotypic features in ais based on prader classification for cah . \n individuals diagnosed with 46xy dsd show an overlap in clinical and biochemical parameters which emphasizes the need for comprehensive evaluation with a multidisciplinary approach . \n this is an ambispective study where all new and old follow - up patients diagnosed with 46xy dsd , being managed at endocrine opd in a period of 16 months ( june 2014october 2015 ) were included . \n external masculinization score ( ems ) were calculated based on the external genitalia of patients . \n abdominopelvic ultrasound was done for the localization of gonads ( magnetic resonance imaging ( mri ) also , when required ) . for patients on follow - up , previous records were reviewed to establish a diagnosis as they were on medication while in new patients , samples were collected and hormonal measurements included serum luteinizing hormone , follicle - stimulating hormone , testosterone , androstenedione ( a ) , cortisol , dehydroepiandrostenedione , and plasma adrenocorticotropic hormone levels by electrochemiluminescence immunoassay using commercial kits ( roche , germany ) . \n radioimmunoassay kit - based method was used for evaluating 17-hydroxyprogesterone ( 17-ohp ) levels ( diagnostic systems laboratories , inc . , webster , tx , usa ) . \n 5dht was measured using radioimmunoassay ( immunotech ; prague , czech republic ) after extraction from other hormones with diethyl ether and celite chromatography . \n the short - term human chorionic gonadotropin ( hcg ) stimulation test was carried out to check the functioning of testicular tissue . \n testosterone levels were measured before and 2448 h after the last injection of a series of three intramuscular injections of hcg on alternate days ( < 1-year - old , 500 units ; 110 years , 1000 units ; > 10 years , 2000 units ) . \n testosterone : androstenedione ( t : a ) and testosterone : 5 dht ( t:5dht ) ratios were calculated as and when required to rule out 17 beta hsd deficiency and 5 alpha reductase deficiency respectively . \n on first evaluation , 11 patients had presented with the primary complaint of ambiguous genitalia , three ( who were being reared as female ) with primary amenorrhea , three with undescended gonads and one with fever and vomiting . \n the presenting complaints , clinical , hormonal , and radiological findings are summarized in table 1 . \n five ( 26% ) of them were reared females and 14 ( 74% ) as males . \n ten patients ( s.5 , s.7 , s.8 , s.9 , s.10 , s.14 , s.15 , s.16 , s.17 , and s.18 ) had undergone corrective surgeries for ambiguous genitalia . \n clinical profile of patients patient s.1 reared as female presented with primary amenorrhea , delayed development of secondary sexual characteristics and unambiguous female genitalia . \n patients s.2 , s.3 , and s.5 had ambiguous genitalia , undescended gonads , raised fsh and low testosterone levels while patient s.4 had unilateral undescended testis with raised fsh and low testosterone levels , all three were suspected to be cases of pgd . \n abdominopelvic ultrasonography ( usg ) and mri could not locate gonads in s.7 while in patient s.6 , a nubbin was seen in the scrotal area . \n inguinal exploration was done to locate testis but it revealed the absence of any testicular tissue . \n fsh was raised in both [ table 2 ] and there was no testosterone response to hcg stimulation . \n hormonal profile of patients patient s.8 being reared as female had presented with ambiguous genitalia and raised gonadotropins . \n she had undergone bilateral gonadectomy and on histological evaluation ot tissue was found , she was diagnosed with ot - dsd . \n patient s.9 being reared as female presented with primary amenorrhea , genital ambiguity and delayed development of secondary sexual characteristics . \n she underwent bilateral gonadectomy , histopathological examination revealed testicular tissue and was diagnosed with cais . \n hormonal profile showed normal testosterone levels with t : dht ratio of 9.7 and t : a ratio of 5.8 . \n patient s.11 being reared as female came with a complaint of hirsutism and delayed development of secondary sexual characteristics . \n bilateral gonadectomy was done and histological studies showed the presence of testicular tissue which confirmed the diagnosis of pais as t : dht and t : a ratios were also normal . \n testosterone levels were undetectable , but showed a good response to hcg stimulation with t : dht ratio of 7.25 , t : a ratio of 5.8 and was diagnosed with pais . \n patients s.13 , s.14 , s.15 , and s.16 came with ambiguous genitalia and low baseline testosterone levels . \n testosterone to dht ratio in s.13 , s.14 , and s.15 were 31.4 , 18 , and 13.9 , respectively . \n due to high t : dht ratio post - hcg stimulation , all three were diagnosed with 5rd while in s.16 , t : dht ratio was not calculated as b / l gonadectomy was done at 2 years of age . \n molecular analysis of srd5a2 gene in this patient revealed r246q mutation commonly seen in 5-rd . \n records show that his post hcg serum t : a ratio was 0.06 , he was thought to be a case of 17hsd deficiency . at 2 years of age he had fever , vomiting and loose stools with hyponatremia , hyperkalemia and hypoglycemia . \n patient s.18 was admitted in pediatrics with a complaint of poor feeding and poor activity since day one of life . on evaluation \n , he was found to have hypernatremia , hypokalemia , and genital ambiguity with bifid scrotum and hypospadias . in view of electrolyte imbalance \n , incomplete masculinization , low cortisol , and elevated 17-ohp , he was suspected to be a case of cah and treatment was started . \n an accurate diagnosis could not be established when he came to us as he was already on steroids and had a history of salt wasting , so steroids could not be stopped for evaluation of the cause of cah . \n he had undergone three genital surgeries for hypospadias correction but still had difficulty in urination . \n the patient is kept on antihypertensives , but no definitive diagnosis could be made as the baseline hormonal reports are missing . with the help of clinical , biochemical and radiological evaluation , \n accurate diagnosis was made in 16 patients while rest 2 are on follow - up and managed in our clinic . \n discordance between genetic ( xx or xy ) , gonadal ( testis or ovaries ) , external genital ( vulva or penis ) , and internal sex ( wolffian or mullerian ducts ) results in dsd . in humans , \n the bipotential gonad differentiates into testis in the presence of sry gene present on y - chromosome . \n testicular differentiation is followed by the development of internal sex ducts and external genitalia in the presence of fetal hormones produced by the testis . \n sertoli cells secrete anti - mullerian hormone , which causes irreversible regression of paramesonephric or mullerian ducts around the sixth week of gestational age . \n testosterone produced by leydig cells of fetal testis promotes the development of mesonephric or wolffian ducts and hence male internal genitalia ; epididymis , vas deferens , and vesicular seminalis . \n the development of external male genitalia depends on the conversion of testosterone to a more potent steroid dht in the presence of 5-reductase enzyme . in 2006 , the term  intersex  or  hermaphrodite  was replaced by  dsd  and \n 46xy dsd was subcategorized as disorders of testicular development and disorders of androgen synthesis or action . \n first - line testing in newborns includes karyotyping , imaging ( usg / mri pelvis ) , serum electrolytes , and serum gonadotropins . \n molecular diagnosis has been made in approximately 20% of cases with 46xy dsd , although confirmatory , but is limited by cost and accessibility . \n the inability of bipotential gonad to differentiate into testis results in testicular dysgenesis or agenesis which occurs due to the disruption of various genetic factors involved in the process of sex determination . in our study , four patients were diagnosed with pgd , one with cgd , one with ot - dsd , and two with testicular agenesis or cba . in the absence of gonadal development , \n patients with cgd usually present with unambiguous female genitalia due to the absence of gonadal steroid production while in pgd , the external phenotype depends upon the degree of testicular tissue present . in our study , out of four patients with pgd , three ( s.2 , s.3 , and s.5 ) presented with ambiguous genitalia and one with undescended gonad ( s.4 ) . in such cases , corrective surgeries are done if required , and testosterone supplementations are given at pubertal age . \n patient s.5 being reared as female had presented with ambiguous genitalia at 4 years of age . with parents consent clitorovaginoplasty and bilateral orchidectomy \n orchidopexy and biopsy are usually recommended for undescended gonads as the risk of malignancy ranges from 8.3% to 54% in patients with xy pgd . in 46xy \n cba is a rare condition and is marked by the absence of testis since birth . \n previous studies have shown the occurrence of pure or partial forms of 46xy gonadal dysgenesis in families of patients with cba , but the genetic cause is still not known . in our study , \n two patients ( s.6 and s.7 ) with cba were born out of nonconsanguineous marriage and had no family history of genital ambiguity but the father of patient s.7 gave history of oligospermia and assisted reproduction . \n 46xy ot - dsd is a very rare condition marked by the presence of ot tissue and is confirmed by histopathological examination . \n parents of patient s.8 had sought medical attention for ambiguous genitalia at the age of 13 years . \n bilateral gonadectomy was done , and the corrective surgeries for hypospadias and phallus are awaited . \n the complete or partial resistance to the action of androgens may result in cais or pais in xy individuals . \n patients with cais may present with primary amenorrhea in adolescence or inguinal swellings in infants . \n patient s.9 was being reared as female , parents sought medical attention at the age of 18 years for primary amenorrhea and delayed development of secondary sexual characteristics . \n bilateral gonadectomy was recommended after confirming the gender identity of the patient to be female . \n a recent study done on 102 phenotypic women with y - chromosome showed an incidence of 17.6% malignancy . \n of these 9 out of 30 patients ( 30% ) of cais with a mean age of 20.7 years were found to have gonadoblastoma on histological analysis . \n therefore , adult cais patients who receive late intervention are recommended to undergo immediate gonadectomy in order to avoid the risk of malignancy . \n the phenotype of patients presenting with pais depends on the responsiveness of genital tissues to androgens . \n infants with pais present with the genital ambiguity of varying degrees while adults may present with gynecomastia . \n however , the risk of malignancy in individuals with pais is 15% if the testis is not scrotal in position . \n hormonal profile showed normal testosterone levels with t : dht ratio of 9.7 and t : a ratio of 5.8 . \n patient s.11 being reared as female sought medical attention for hirsutism at the age of 19 years . \n biochemical examination showed normal t : dht and t : a ratios with testosterone levels in male range . \n gonadectomy was done and histopathological examination showed the presence of testicular tissue , she was then diagnosed with pais . \n she had female gender orientation and is now on estrogen replacement therapy for breast development . \n his t : dht ratio was 7.25 and t : a ratio was 5.8 post - hcg stimulation , which excluded the diagnosis of 5rd and 17hsd . \n though the presumptive diagnosis of patients s.10 , s.11 , and s.12 was pais , as t : dht ratio and t : a ratio were normal , [ figure 1 ] diagnosis with needs further confirmation by molecular studies . flow chart for \n diagnosis of 46xy disorders of sexual development the interrupted conversion of testosterone to dht due to the mutations in gene encoding 5-reductase enzyme may lead to 5rd . \n the differentiation of internal and external male genitalia occurs in the presence of testosterone ( t ) and dht . \n the t : dht ratio is used to diagnose this condition but interpreting these results is not always straightforward . \n the diagnosis of 5rd is suspected in newborns with undermasculinized genitalia ( depending upon the activity of enzyme 5-reductase ) , low serum testosterone levels , good response to hcg stimulation and high testosterone to dht ratio ( > 1012 ) . a good response to hcg stimulation ( rise by more than twice the baseline value ) is observed in these patients . \n the patients may present with microphallus , inguinal gonads or gonads in labioscrotal folds and varying degree of hypospadias . \n treatment with percutaneous dht increases the size of the phallus in infants and children with 5-reductase 2 deficiency . \n most of them are reared as males and gender reassignment is required in those who are reared as females due to the spontaneous virilization at puberty . \n the decisions regarding management of masculinizing puberty need to be taken before puberty with a multidisciplinary approach . \n female gender assignment in these patients by surgery should be undertaken postpuberty with full caution and counseling with parents . in our study , \n patient s.16 had severely undervirilized genitalia , bilateral gonadectomy had been done at 2 years of age and female gender had been assigned . at the age of 17 years , he sought medical attention for gender dysphoria . at this time , the presence of common r246q mutation on molecular analysis of srd5a2 gene confirmed the diagnosis of 5rd . \n 46xy patients with deficiency of 17-hsd enzyme usually present with female - like genitalia at birth with clitoromegaly and blind - ending vagina or male type genitalia with micropenis and hypospadias . at puberty , these patients experience significant virilization due to the abnormally elevated levels of androstenedione or extragonadal synthesis of testosterone , the exact cause of which is unknown . \n the diagnosis of 17-hsd3 can be suspected if testosterone to androstenedione ratio is < 0.8 . \n the overlapping phenotype of individuals with 17-hsd and pais can be differentiated by molecular analysis or on the basis of hcg stimulated t : a ratio , which is < 0.8 in cases of 17-hsd . \n patient s.17 initially predicted to have 17 hsd deficiency , but later presented with features of mineralocorticoid and glucocorticoid deficiency at 2 years of age . \n patient s.19 is presently 49 years of age and gave a history of ambiguous genitalia . \n he was on dexamethasone , sustanon and had undergone three corrective surgeries for hypospadias but still has a problem in urination . routine examination revealed raised blood pressure for which he is on hypertensives . \n limitations of this study are that , being an ambispective study , all tests were not done in all patients and baseline records / tests to make a diagnosis could not be obtained in two patients . \n nonetheless , this gives an insight into how to diagnose and manage 46xy dsd , who may present at different ages , with different etiologies and different gender of rearing in our set up . \n there is overlap in the clinical , hormonal and anatomic profile of different subsets of 46xy dsd . \n the diagnosis of 46xy dsd needs to be confirmed by cytogenetic , hormonal , radiological , and genetic tests . \n phenotype varies depending on the degree of genetic , hormonal and anatomic defect . at times , in spite of all the tests a definitive diagnosis may not be possible . \n the pediatrician , endocrinologist , surgeon , psychologist , and clinical geneticist need to work as a team for multifaceted management of these patients . \n this study was supported by department of biotechnology , ministry of science and technology ( bt / pr7681/med/12/597/2013 ) and indian council of medical research ( dhr / gia/1/2014 ) , new delhi , india . \n this study was supported by department of biotechnology , ministry of science and technology ( bt / pr7681/med/12/597/2013 ) and indian council of medical research ( dhr / gia/1/2014 ) , new delhi , india ")
#print(result["summary"])
